"use strict";function initTable(id,tableOptions){var containerId=id+"-handsontable-container";var tableHeaderCheckboxId=id+"-handsontable-header";var colHeaderCheckboxId=id+"-handsontable-col-header";var hiddenStreamInput=$("#"+id);var tableHeaderCheckbox=$("#"+tableHeaderCheckboxId);var colHeaderCheckbox=$("#"+colHeaderCheckboxId);var hot;var defaultOptions;var finalOptions={};var persist;var cellEvent;var structureEvent;var dataForForm=null;var getWidth=function(){return $(".widget-table_input").closest(".sequence-member-inner").width()};var getHeight=function(){var tableParent=$("#"+id).parent();return tableParent.find(".htCore").height()+tableParent.find(".input").height()*2};var height=getHeight();var resizeTargets=[".input > .handsontable",".wtHider",".wtHolder"];var resizeHeight=function(height){var currTable=$("#"+id);$.each(resizeTargets,function(){currTable.closest(".field-content").find(this).height(height)})};function resizeWidth(width){$.each(resizeTargets,function(){$(this).width(width)});var parentDiv=$(".widget-table_input").parent();parentDiv.find(".field-content").width(width);parentDiv.find(".fieldname-table .field-content .field-content").width("80%")}try{dataForForm=$.parseJSON(hiddenStreamInput.val())}catch(e){}if(dataForForm!==null){if(dataForForm.hasOwnProperty("first_row_is_table_header")){tableHeaderCheckbox.prop("checked",dataForForm.first_row_is_table_header)}if(dataForForm.hasOwnProperty("first_col_is_header")){colHeaderCheckbox.prop("checked",dataForForm.first_col_is_header)}}if(!tableOptions.hasOwnProperty("width")||!tableOptions.hasOwnProperty("height")){$(window).resize(function(){hot.updateSettings({width:getWidth(),height:getHeight()});resizeWidth("100%")})}persist=function(){hiddenStreamInput.val(JSON.stringify({data:hot.getData(),first_row_is_table_header:tableHeaderCheckbox.prop("checked"),first_col_is_header:colHeaderCheckbox.prop("checked")}))};cellEvent=function(change,source){if(source==="loadData"){return}persist()};structureEvent=function(index,amount){resizeHeight(getHeight());persist()};tableHeaderCheckbox.change(function(){persist()});colHeaderCheckbox.change(function(){persist()});defaultOptions={afterChange:cellEvent,afterCreateCol:structureEvent,afterCreateRow:structureEvent,afterRemoveCol:structureEvent,afterRemoveRow:structureEvent,contextMenu:["row_above","row_below","---------","col_left","col_right","---------","remove_row","remove_col","---------","undo","redo"]};if(dataForForm!==null&&dataForForm.hasOwnProperty("data")){defaultOptions.data=dataForForm.data}Object.keys(defaultOptions).forEach(function(key){finalOptions[key]=defaultOptions[key]});Object.keys(tableOptions).forEach(function(key){finalOptions[key]=tableOptions[key]});hot=new Handsontable(document.getElementById(containerId),finalOptions);hot.render();if("resize"in $(window)){resizeHeight(getHeight());$(window).load(function(){$(window).resize()})}}