(function($){var StreamBlockMenu=function(opts){var self={};self.container=$("#"+opts.id);self.inner=$(".stream-menu-inner",self.container);self.blocklist=$("ul",self.inner);if(self.container.hasClass("stream-menu-closed")){self.inner.css("height",0)}self.show=function(){self.inner.animate({height:self.blocklist.outerHeight()},250,"swing",function(){$(this).height("auto")});self.container.removeClass("stream-menu-closed")};self.hide=function(){self.inner.animate({height:0},250);self.container.addClass("stream-menu-closed")};self.addFirstBlock=function(){if(opts.onChooseBlock)opts.onChooseBlock(opts.childBlocks[0])};self.toggle=function(){if(self.container.hasClass("stream-menu-closed")){if(opts.childBlocks.length==1){self.addFirstBlock()}else{self.show()}}else{self.hide()}};self.container.click(function(e){e.preventDefault();self.toggle()});$.each(opts.childBlocks,function(i,childBlock){var button=self.container.find(".action-add-block-"+childBlock.name);button.click(function(){if(opts.onChooseBlock)opts.onChooseBlock(childBlock)})});return self};window.StreamBlock=function(opts){var listMemberTemplates={};var childBlocksByName={};for(var i=0;i<opts.childBlocks.length;i++){var childBlock=opts.childBlocks[i];childBlocksByName[childBlock.name]=childBlock;var template=$("#"+opts.definitionPrefix+"-newmember-"+childBlock.name).text();listMemberTemplates[childBlock.name]=template}return function(elementPrefix){var sequence=Sequence({prefix:elementPrefix,onInitializeMember:function(sequenceMember){var blockTypeName=$("#"+sequenceMember.prefix+"-type").val();var blockOpts=childBlocksByName[blockTypeName];if(blockOpts.initializer){blockOpts.initializer(sequenceMember.prefix+"-value")}$("#"+sequenceMember.prefix+"-delete").click(function(){sequenceMember.delete()});$("#"+sequenceMember.prefix+"-moveup").click(function(){sequenceMember.moveUp()});$("#"+sequenceMember.prefix+"-movedown").click(function(){sequenceMember.moveDown()});StreamBlockMenu({childBlocks:opts.childBlocks,id:sequenceMember.prefix+"-appendmenu",onChooseBlock:function(childBlock){var template=listMemberTemplates[childBlock.name];sequenceMember.appendMember(template)}})},onEnableMoveUp:function(sequenceMember){$("#"+sequenceMember.prefix+"-moveup").removeClass("disabled")},onDisableMoveUp:function(sequenceMember){$("#"+sequenceMember.prefix+"-moveup").addClass("disabled")},onEnableMoveDown:function(sequenceMember){$("#"+sequenceMember.prefix+"-movedown").removeClass("disabled")},onDisableMoveDown:function(sequenceMember){$("#"+sequenceMember.prefix+"-movedown").addClass("disabled")}});StreamBlockMenu({childBlocks:opts.childBlocks,id:elementPrefix+"-prependmenu",onChooseBlock:function(childBlock){var template=listMemberTemplates[childBlock.name];sequence.insertMemberAtStart(template)}})}}})(jQuery);