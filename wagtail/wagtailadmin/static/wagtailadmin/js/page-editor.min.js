"use strict";var halloPlugins={halloformat:{},halloheadings:{formatBlocks:["p","h2","h3","h4","h5"]},hallolists:{},hallohr:{},halloreundo:{},hallowagtaillink:{},hallorequireparagraphs:{}};function registerHalloPlugin(name,opts){halloPlugins[name]=opts||{}}function dateEqual(x,y){return x.getDate()===y.getDate()&&x.getMonth()===y.getMonth()&&x.getYear()===y.getYear()}function hideCurrent(current,input){var selected=new Date(input[0].value);if(!dateEqual(selected,current)){$(this).find(".xdsoft_datepicker .xdsoft_current:not(.xdsoft_today)").removeClass("xdsoft_current")}}function initDateChooser(id,opts){if(window.dateTimePickerTranslations){$("#"+id).datetimepicker($.extend({closeOnDateSelect:true,timepicker:false,scrollInput:false,format:"Y-m-d",i18n:{lang:window.dateTimePickerTranslations},lang:"lang",onGenerate:hideCurrent},opts||{}))}else{$("#"+id).datetimepicker($.extend({timepicker:false,scrollInput:false,format:"Y-m-d",onGenerate:hideCurrent},opts||{}))}}function initTimeChooser(id){if(window.dateTimePickerTranslations){$("#"+id).datetimepicker({closeOnDateSelect:true,datepicker:false,scrollInput:false,format:"H:i",i18n:{lang:window.dateTimePickerTranslations},lang:"lang"})}else{$("#"+id).datetimepicker({datepicker:false,format:"H:i"})}}function initDateTimeChooser(id,opts){if(window.dateTimePickerTranslations){$("#"+id).datetimepicker($.extend({closeOnDateSelect:true,format:"Y-m-d H:i",scrollInput:false,i18n:{lang:window.dateTimePickerTranslations},language:"lang",onGenerate:hideCurrent},opts||{}))}else{$("#"+id).datetimepicker($.extend({format:"Y-m-d H:i",onGenerate:hideCurrent},opts||{}))}}function InlinePanel(opts){var self={};self.setHasContent=function(){if($("> li",self.formsUl).not(".deleted").length){self.formsUl.parent().removeClass("empty")}else{self.formsUl.parent().addClass("empty")}};self.initChildControls=function(prefix){var childId="inline_child_"+prefix;var deleteInputId="id_"+prefix+"-DELETE";self.setHasContent();$("#"+deleteInputId+"-button").click(function(){$("#"+deleteInputId).val("1");$("#"+childId).addClass("deleted").slideUp(function(){self.updateMoveButtonDisabledStates();self.updateAddButtonState();self.setHasContent()})});if(opts.canOrder){$("#"+prefix+"-move-up").click(function(){var currentChild=$("#"+childId);var currentChildOrderElem=currentChild.find('input[name$="-ORDER"]');var currentChildOrder=currentChildOrderElem.val();var prevChild=currentChild.prevAll(":not(.deleted)").first();if(!prevChild.length)return;var prevChildOrderElem=prevChild.find('input[name$="-ORDER"]');var prevChildOrder=prevChildOrderElem.val();self.animateSwap(currentChild,prevChild);currentChild.insertBefore(prevChild);currentChildOrderElem.val(prevChildOrder);prevChildOrderElem.val(currentChildOrder);self.updateMoveButtonDisabledStates()});$("#"+prefix+"-move-down").click(function(){var currentChild=$("#"+childId);var currentChildOrderElem=currentChild.find('input[name$="-ORDER"]');var currentChildOrder=currentChildOrderElem.val();var nextChild=currentChild.nextAll(":not(.deleted)").first();if(!nextChild.length)return;var nextChildOrderElem=nextChild.find('input[name$="-ORDER"]');var nextChildOrder=nextChildOrderElem.val();self.animateSwap(currentChild,nextChild);currentChild.insertAfter(nextChild);currentChildOrderElem.val(nextChildOrder);nextChildOrderElem.val(currentChildOrder);self.updateMoveButtonDisabledStates()})}if($("#"+deleteInputId).val()==="1"){$("#"+childId).addClass("deleted").hide(0,function(){self.updateMoveButtonDisabledStates();self.updateAddButtonState();self.setHasContent()});$("#"+childId).find(".error-message").remove()}};self.formsUl=$("#"+opts.formsetPrefix+"-FORMS");self.updateMoveButtonDisabledStates=function(){if(opts.canOrder){var forms=self.formsUl.children("li:visible");forms.each(function(i){$("ul.controls .inline-child-move-up",this).toggleClass("disabled",i===0).toggleClass("enabled",i!==0);$("ul.controls .inline-child-move-down",this).toggleClass("disabled",i===forms.length-1).toggleClass("enabled",i!=forms.length-1)})}};self.updateAddButtonState=function(){if(opts.maxForms){var forms=self.formsUl.children("li:visible");var addButton=$("#"+opts.formsetPrefix+"-ADD");if(forms.length>=opts.maxForms){addButton.addClass("disabled")}else{addButton.removeClass("disabled")}}};self.animateSwap=function(item1,item2){var parent=self.formsUl;var children=parent.children("li:visible");parent.addClass("moving").css("height",parent.height());children.each(function(){$(this).css("top",$(this).position().top)}).addClass("moving");item1.animate({top:item2.position().top},200,function(){parent.removeClass("moving").removeAttr("style");children.removeClass("moving").removeAttr("style")});item2.animate({top:item1.position().top},200,function(){parent.removeClass("moving").removeAttr("style");children.removeClass("moving").removeAttr("style")})};buildExpandingFormset(opts.formsetPrefix,{onAdd:function(formCount){var newChildPrefix=opts.emptyChildFormPrefix.replace(/__prefix__/g,formCount);self.initChildControls(newChildPrefix);if(opts.canOrder){$("#id_"+newChildPrefix+"-ORDER").val(formCount+1)}self.updateMoveButtonDisabledStates();self.updateAddButtonState();if(opts.onAdd)opts.onAdd()}});return self}function cleanForSlug(val,useURLify){if(useURLify){return URLify(val,255,unicodeSlugsEnabled)}else{if(unicodeSlugsEnabled){return val.replace(/\s/g,"-").replace(/[&\/\\#,+()$~%.'":`@\^!*?<>{}]/g,"").toLowerCase()}else{return val.replace(/\s/g,"-").replace(/[^A-Za-z0-9\-\_]/g,"").toLowerCase()}}}function initSlugAutoPopulate(){var slugFollowsTitle=false;$("#id_title").on("focus",function(){var currentSlug=$("#id_slug").val();var slugifiedTitle=cleanForSlug(this.value,true);slugFollowsTitle=currentSlug==slugifiedTitle});$("#id_title").on("keyup keydown keypress blur",function(){if(slugFollowsTitle){var slugifiedTitle=cleanForSlug(this.value,true);$("#id_slug").val(slugifiedTitle)}})}function initSlugCleaning(){$("#id_slug").blur(function(){$(this).val(cleanForSlug($(this).val(),false))})}function initErrorDetection(){var errorSections={};$(".error-message").each(function(){var parentSection=$(this).closest("section");if(!errorSections[parentSection.attr("id")]){errorSections[parentSection.attr("id")]=0}errorSections[parentSection.attr("id")]=errorSections[parentSection.attr("id")]+1});for(var index in errorSections){$('.tab-nav a[href="#'+index+'"]').addClass("errors").attr("data-count",errorSections[index])}}function initCollapsibleBlocks(){$(".object.multi-field.collapsible").each(function(){var $li=$(this);var $fieldset=$li.find("fieldset");if($li.hasClass("collapsed")&&$li.find(".error-message").length==0){$fieldset.hide()}$li.find("> h2").click(function(){if(!$li.hasClass("collapsed")){$li.addClass("collapsed");$fieldset.hide("slow")}else{$li.removeClass("collapsed");$fieldset.show("show")}})})}function initKeyboardShortcuts(){Mousetrap.bind(["mod+p"],function(e){$(".action-preview").trigger("click");return false});Mousetrap.bind(["mod+s"],function(e){$(".action-save").trigger("click");return false})}$(function(){if(!$("body").hasClass("page-is-live")){initSlugAutoPopulate()}initSlugCleaning();initErrorDetection();initCollapsibleBlocks();initKeyboardShortcuts();var $previewButton=$(".action-preview"),$form=$("#page-edit-form");var previewUrl=$previewButton.data("action");var autoUpdatePreviewDataTimeout=-1;function setPreviewData(){return $.ajax({url:previewUrl,method:"POST",data:new FormData($form[0]),processData:false,contentType:false})}$previewButton.one("click",function(){if($previewButton.data("auto-update")){$form.on("change keyup DOMSubtreeModified",function(){clearTimeout(autoUpdatePreviewDataTimeout);autoUpdatePreviewDataTimeout=setTimeout(setPreviewData,1e3)}).change()}});$previewButton.click(function(e){e.preventDefault();var $this=$(this);var $icon=$this.filter(".icon"),thisPreviewUrl=$this.data("action");$icon.addClass("icon-spinner").removeClass("icon-view");var previewWindow=window.open("",thisPreviewUrl);previewWindow.focus();setPreviewData().done(function(data){if(data["is_valid"]){previewWindow.document.location=thisPreviewUrl}else{window.focus();previewWindow.close();$form.submit()}}).fail(function(){alert("Error while sending preview data.");window.focus();previewWindow.close()}).always(function(){$icon.addClass("icon-view").removeClass("icon-spinner")})})});