function addMessage(status,text){$(".messages").addClass("new").empty().append('<ul><li class="'+status+'">'+text+"</li></ul>");var addMsgTimeout=setTimeout(function(){$(".messages").addClass("appear");clearTimeout(addMsgTimeout)},100)}function escapeHtml(text){var map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return text.replace(/[&<>"']/g,function(m){return map[m]})}function initTagField(id,autocompleteUrl,allowSpaces){$("#"+id).tagit({autocomplete:{source:autocompleteUrl},preprocessTag:function(val){if(val&&val[0]!='"'&&val.indexOf(" ")>-1){return'"'+val+'"'}return val},allowSpaces:allowSpaces})}function enableDirtyFormCheck(formSelector,options){var $form=$(formSelector);var confirmationMessage=options.confirmationMessage||" ";var alwaysDirty=options.alwaysDirty||false;var initialData=$form.serialize();var formSubmitted=false;$form.submit(function(){formSubmitted=true});window.addEventListener("beforeunload",function(event){var displayConfirmation=!formSubmitted&&(alwaysDirty||$form.serialize()!=initialData);if(displayConfirmation){event.returnValue=confirmationMessage;return confirmationMessage}})}$(function(){$("body").addClass("ready");$(document).on("click","#nav-toggle",function(){$("body").toggleClass("nav-open");if(!$("body").hasClass("nav-open")){$("body").addClass("nav-closed")}else{$("body").removeClass("nav-closed")}});$(document).on("click","#account-settings",function(){$("#footer").toggleClass("footer-open");$(this).find("em").toggleClass("icon-arrow-down-after icon-arrow-up-after")});var fitNav=function(){$(".nav-wrapper").css("min-height",$(window).height());$(".nav-main").each(function(){var thisHeight=$(this).height();var footerHeight=$("#footer",$(this)).height()})};fitNav();$(window).resize(function(){fitNav()});$(document).on("focus mouseover","input,textarea,select",function(){$(this).closest(".field").addClass("focused");$(this).closest("fieldset").addClass("focused");$(this).closest("li").addClass("focused")});$(document).on("blur mouseout","input,textarea,select",function(){$(this).closest(".field").removeClass("focused");$(this).closest("fieldset").removeClass("focused");$(this).closest("li").removeClass("focused")});$(document).on("click",".tab-nav a",function(e){e.preventDefault();$(this).tab("show")});$(document).on("click",".tab-toggle",function(e){e.preventDefault();$('.tab-nav a[href="'+$(this).attr("href")+'"]').click()});$(".dropdown").each(function(){var $dropdown=$(this);$(".dropdown-toggle",$dropdown).on("click",function(e){e.stopPropagation();$dropdown.toggleClass("open");if($dropdown.hasClass("open")){$(document).on("click.dropdown.cancel",function(e){var relTarg=e.relatedTarget||e.toElement;if(!$(relTarg).parents().is($dropdown)){$dropdown.removeClass("open");$(document).off("click.dropdown.cancel")}})}else{$(document).off("click.dropdown.cancel")}})});$(".drop-zone").on("dragover",function(){$(this).addClass("hovered")}).on("dragleave dragend drop",function(){$(this).removeClass("hovered")});if(window.headerSearch){var searchCurrentIndex=0;var searchNextIndex=0;$(window.headerSearch.termInput).on("keyup cut paste",function(){clearTimeout($.data(this,"timer"));var wait=setTimeout(search,200);$(this).data("timer",wait)});$(window.headerSearch.termInput).trigger("focus");function search(){var workingClasses="icon-spinner";$(window.headerSearch.termInput).parent().addClass(workingClasses);searchNextIndex++;var index=searchNextIndex;$.ajax({url:window.headerSearch.url,data:{q:$(window.headerSearch.termInput).val()},success:function(data,status){if(index>searchCurrentIndex){searchCurrentIndex=index;$(window.headerSearch.targetOutput).html(data).slideDown(800);window.history.pushState(null,"Search results","?q="+$(window.headerSearch.termInput).val())}},complete:function(){$(window.headerSearch.termInput).parent().removeClass(workingClasses)}})}}$(document).on("shown.bs.tab",function(e){$("textarea[data-autosize-on]").each(function(){autosize.update($(this).get())})});$(document).on("click","button.button-longrunning",function(e){var $self=$(this);var $replacementElem=$("em",$self);var reEnableAfter=30;var dataName="disabledtimeout";window.cancelSpinner=function(){$self.prop("disabled","").removeData(dataName).removeClass("button-longrunning-active");if($self.data("clicked-text")){$replacementElem.text($self.data("original-text"))}};var form=$self.closest("form").get(0);if(form&&form.checkValidity&&!form.noValidate&&!form.checkValidity()){return}var timeout=setTimeout(function(){if(!$self.data(dataName)){$self.data(dataName,setTimeout(function(){clearTimeout($self.data(dataName));cancelSpinner()},reEnableAfter*1e3));if($self.data("clicked-text")&&$replacementElem.length){$self.data("original-text",$replacementElem.text());$replacementElem.text($self.data("clicked-text"))}$self.addClass("button-longrunning-active").prop("disabled","true")}clearTimeout(timeout)},10)})});var wagtail=window.wagtail=null;wagtail=function(document,window,wagtail){if(!wagtail){wagtail={ui:{}}}var DROPDOWN_SELECTOR="[data-dropdown]";var LISTING_TITLE_SELECTOR="[data-listing-page-title]";var LISTING_ACTIVE_CLASS="listing__item--active";var ICON_DOWN="icon-arrow-down";var ICON_UP="icon-arrow-up";var IS_OPEN="is-open";var clickEvent="click";var TOGGLE_SELECTOR="[data-dropdown-toggle]";var ARIA="aria-hidden";var keys={ESC:27,ENTER:13,SPACE:32};var DropDownController={_dropDowns:[],closeAllExcept:function(dropDown){var index=this._dropDowns.indexOf(dropDown);this._dropDowns.forEach(function(item,i){if(i!==index&&item.state.isOpen){item.closeDropDown()}})},add:function(dropDown){this._dropDowns.push(dropDown)},get:function(){return this._dropDowns},getByIndex:function(index){return this._dropDowns[index]},getOpenDropDown:function(){var needle=null;this._dropDowns.forEach(function(item){if(item.state.isOpen){needle=item}});return needle}};function DropDown(el,registry){if(!el||!registry){if("error"in console){console.error("A dropdown was created without an element or the DropDownController.\nMake sure to pass both to your component.");return}}this.el=el;this.$parent=$(el).parents(LISTING_TITLE_SELECTOR);this.state={isOpen:false};this.registry=registry;this.clickOutsideDropDown=this._clickOutsideDropDown.bind(this);this.closeDropDown=this._closeDropDown.bind(this);this.openDropDown=this._openDropDown.bind(this);this.handleClick=this._handleClick.bind(this);this.handleKeyEvent=this._handleKeyEvent.bind(this);el.addEventListener(clickEvent,this.handleClick);el.addEventListener("keydown",this.handleKeyEvent);this.$parent.data("close",this.closeDropDown)}DropDown.prototype={_handleKeyEvent:function(e){var validTriggers=[keys.SPACE,keys.ENTER];if(validTriggers.indexOf(e.which)>-1){e.preventDefault();this.handleClick(e)}},_handleClick:function(e){var el=this.el;if(!this.state.isOpen){this.openDropDown(e)}else{this.closeDropDown(e)}},_openDropDown:function(e){e.stopPropagation();e.preventDefault();var el=this.el;var $parent=this.$parent;var toggle=el.querySelector(TOGGLE_SELECTOR);this.state.isOpen=true;this.registry.closeAllExcept(this);el.classList.add(IS_OPEN);el.setAttribute(ARIA,false);toggle.classList.remove(ICON_DOWN);toggle.classList.add(ICON_UP);document.addEventListener(clickEvent,this.clickOutsideDropDown,false);$parent.addClass(LISTING_ACTIVE_CLASS)},_closeDropDown:function(e){this.state.isOpen=false;var el=this.el;var $parent=this.$parent;var toggle=el.querySelector(TOGGLE_SELECTOR);document.removeEventListener(clickEvent,this.clickOutsideDropDown,false);el.classList.remove(IS_OPEN);toggle.classList.add(ICON_DOWN);toggle.classList.remove(ICON_UP);el.setAttribute(ARIA,true);$parent.removeClass(LISTING_ACTIVE_CLASS)},_clickOutsideDropDown:function(e){var el=this.el;var relTarget=e.relatedTarget||e.toElement;if(!$(relTarget).parents().is(el)){this.closeDropDown()}}};function initDropDown(){var dropDown=new DropDown(this,DropDownController);DropDownController.add(dropDown)}function handleKeyPress(e){if(e.which===keys.ESC){var open=DropDownController.getOpenDropDown();if(open){open.closeDropDown()}}}function initDropDowns(){$(DROPDOWN_SELECTOR).each(initDropDown);$(document).on("keydown",handleKeyPress)}$(document).ready(initDropDowns);wagtail.ui.DropDownController=DropDownController;return wagtail}(document,window,wagtail);