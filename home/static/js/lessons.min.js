function reloadPage(c,b){b=void 0===b?0:b;$.ajax({type:"GET",url:Urls["api:get_lesson_content"](c,1,b),beforeSend:function(){b&&$("#lazy-"+b).html("\u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435, \u0438\u0434\u0451\u0442 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430...")},success:function(c){b&&$("#lazy-"+b).hide();c.tabs.forEach(function(b,c){if(null!=b.value){var e=$('a.nav-link[href="#'+b.href+'"]');e.html(b.title);if(b.transition)$(document).on("hidden.bs.modal",function(){e.parent().fadeIn(500);
e.css({"background-color":"#90ee90",color:"#003e73",transition:"background-color 0.5s ease"});setTimeout(function(){e.css({"background-color":"#ffffff",color:"",transition:"background-color 10s ease"})},500)});$("div.tab-pane#"+b.href).html(b.value)}});$('[data-toggle="popover"]').popover()}})}
function reloadLessonUrl(){$.ajax({type:"POST",url:"/api/get_lesson_url/",data:{csrfmiddlewaretoken:CSRF_TOKEN,lesson_number:LESSON_NUMBER},datatype:"json",success:function(c){if(200===c.status){var b=$("#lesson-audio")[0],f=b.currentTime;b.src(c.lesson_url);b.load();b.currentTime=f;b.play()}}})}function errHandle(c){console.log("Error "+c.error.code+"; details: "+c.error.message)}
$(document).ready(function(){function c(){var a=$("<button class='coffee-button btn btn-success btn-xs' disabled='disabled' id='coffee-button'><img id='coffee-button-image' class='coffee-button-image'"+(" src='"+BY_ME_A_COFFEE_SVG+"'")+"<div id='coffee-button-text' class='coffee-button-text'>\u0412\u044b \u0443\u0436\u0435 \u0443\u0433\u043e\u0449\u0430\u043b\u0438 \u043c\u0435\u043d\u044f<br>\u0437\u0430 \u044d\u0442\u043e\u0442 \u0443\u0440\u043e\u043a :)</div></button>");$("#coffee-button").replaceWith(a)}
function b(a){switch(a){case "get_state":$.ajax({type:"POST",url:Urls["custom_user:saw_message"](),data:{csrfmiddlewaretoken:CSRF_TOKEN,action:"get_state"},success:function(a){if(200===a.status)return!0}});break;case "make_true":saw_message=!0,$.ajax({type:"POST",async:!1,url:Urls["custom_user:saw_message"](),data:{csrfmiddlewaretoken:CSRF_TOKEN,action:"make_true"},success:function(a){if(200===a.status)return!0}})}}$("a#tab-flash-cards").one("show.bs.tab",function(){reloadPage(LESSON_NUMBER,"flash-cards")});
var f=window.navigator.userAgent,g=!!f.match(/iPad/i)||!!f.match(/iPhone/i),h=!!f.match(/WebKit/i),e=g&&h&&!f.match(/CriOS/i);if(NEED_PAYMENT){var d=function(a){switch(a){case "tab":case "download":case "ended":a=$("#lesson-audio")[0];localStorage["lecon-{{ self.lesson_number }}"]=a.duration-5;IS_AUTHENTICATED?saw_message?$("#lesson-not-activated-simple-modal").modal("show"):$("#lesson-not-activated-details-continue-modal").modal("show"):$("#listen-login-required-modal").modal("show");break;case "button":saw_message?
d("proceed"):$("#lesson-not-activated-details-activate-modal").modal("show");break;case "saw":b("make_true");break;case "proceed":userlesson||k()}},k=function(){$(".success-message").hide();$(".fail-message").hide();$(".minus-cups").hide();$(".unsofficiant-cups-credit").hide();$(".waiting-message").show();$("#lesson-activated-modal").modal("show");$.ajax({type:"POST",url:Urls["activate:activate_lesson"](),data:{csrfmiddlewaretoken:CSRF_TOKEN,lesson_number:LESSON_NUMBER},datatype:"json",cache:!1,headers:{"cache-control":"no-cache"},
async:!e,success:function(a){"SUCCESS"===a.result?(a=Math.floor(1E3*Math.random())%4,console.log(a),a="https://files.le-francais.ru/sound/"+activateSounds[a],$('<audio class="sound-player" autoplay="autoplay" style="display:none;"><source src="'+a+'" /><embed src="'+a+'" hidden="true" autostart="true" loop="false"/></audio>').appendTo("body")[0].play(),window.location.href=window.location.pathname+"?"+$.param({modal_open:"lesson-activated-modal"})):"ZERO_CUPS"===a.result?($(".waiting-message").hide(),
$(".unsofficiant-cups").show(),0>cups_amount&&0===cups_credit&&($("#activated-dismiss-button").hide(),$("#activated-unsofficiant-cups-button").hide(),$(".unsofficiant-cups-credit").show())):"ALREADY"===a.result?($(".waiting-message").hide(),$(".already-activated").show()):"NOT_AUTH"===a.result&&($(".waiting-message").hide(),$(".login-need").show())}})};$("[data-saw-proceed]").on("click",function(){d("saw");setTimeout(d("proceed"),1E3)});activateSounds=["composter-01.mp3","composter-02.mp3","composter-03.mp3",
"composter-04.mp3"];if(!userlesson&&must_pay||NEED_PAYMENT&&!IS_AUTHENTICATED)window.addEventListener("lessonPlayerReady",function(){$(".audioplayer-download-button")[0].addEventListener("click",function(){d("download")});$("#lesson-audio")[0].addEventListener("ended",function(){d("ended")})}),$("[data-activate-lesson]").click(function(){d($(this).data("activate-lesson"))}),$("#tab-flash-cards").removeAttr("data-toggle"),$("#tab-exercises-de-lesson").removeAttr("data-toggle"),$("#tab-exercise").removeAttr("data-toggle"),
$("#tab-flash-cards").click(function(a){a.preventDefault();d("tab")}),$("#tab-exercises-de-lesson").click(function(a){a.preventDefault();d("tab")}),$("#tab-exercise").click(function(a){a.preventDefault();d("tab")})}else if(!IS_AUTHENTICATED&&5<LESSON_NUMBER)$(window).one("lessonPlayerReady",function(){$(".audioplayer-download-button").on("click",function(a){a.preventDefault();$.ajax({url:Urls["modal:download_login_required"](),type:"GET",data:{redirect_url:window.location.pathname},datatype:"html",
success:function(a){$(a).modal("show")}})})});$(".coffee-proceed").on("click",function(){$(".modal").modal("hide");$.ajax({type:"POST",url:Urls["coffee:give_me_a_coffee"](),data:{lesson_number:LESSON_NUMBER,csrfmiddlewaretoken:CSRF_TOKEN},async:!e,datatype:"json",cache:!1,headers:{"cache-control":"no-cache"},success:function(a){"SUCCESS"===a.result?((new Audio(COFFEE_SOUND_URL)).play(),$("#give-me-a-coffee-success-message").html(a.description),$("#give-me-a-coffee-complete-modal").modal("show"),c(),
reloadPage(LESSON_NUMBER)):"ALREADY"===a.result?($("#give-me-a-coffee-fail-message").html(a.description),$("#give-me-a-coffee-fail-modal").modal("show"),c(),reloadPage(LESSON_NUMBER)):($("#give-me-a-coffee-fail-message").html(a.description),$("#give-me-a-coffee-fail-modal").modal("show"))},error:function(a,b){$("#give-me-a-coffee-fail-message").html(b);$("#give-me-a-coffee-fail-modal").modal("show")}})})});
