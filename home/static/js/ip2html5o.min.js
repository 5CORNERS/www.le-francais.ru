var player,stopTime,showMenu=!0,html5=!0,subtractBy=.1,gecko=!1,speakingQuiztimeoutID=-1;function stopNow(){timeID=-1,player.pause(),playing=!1,speakingQuiz&&(speakingQuiztimeoutID=setTimeout(selectNextSpeakingQuizElement,1500))}function stopSimple(){timeID=-1,player.pause(),playing=!1}function seekEvent(){player.play(),timeID=setTimeout(stopNow,stopTime)}function stopPlayingTitle(){console.log("stopPlayingTitle"),timeID=setTimeout(stopNow,1e3*(times[0]-.1)-player.currentTime),loadedVar=!0}var titleFinishedPlaying=!1;function startPlaying(){player.addEventListener("play",function(e){titleFinishedPlaying||(stopPlayingTitle(),titleFinishedPlaying=!0)},!0);var e=player.play();void 0!==e&&e.then(function(){}).catch(function(e){var t=document.createElement("button");t.style="position: fixed;top: 50%;left: 50%;margin-top: -50px;margin-left: -100px;width: 250px;height: 100px;font-size: 200%;z-index: 501;",t.id="launch",t.innerHTML="Launch Audio",document.body.appendChild(t),t.focus(),addDarkModel(),t.addEventListener("click",function(e){player.play(),stopPlayingTitle(),t.style.display="none",document.getElementById("modalPage").style.display="none",e.preventDefault(),e.stopPropagation&&e.stopPropagation()})})}function setPlayerVariable(){(player=document.getElementsByTagName("audio")[0])||(player=document.getElementsByTagName("video")[0]),player&&(player.addEventListener("canplaythrough",function(){startPlaying()}),-1!==navigator.userAgent.indexOf("AppleWebKit")?(slowSeek=!0,player.addEventListener("seeked",seekEvent,!1)):-1!=navigator.userAgent.indexOf("Firefox")&&(slowSeek=!0,player.addEventListener("seeked",seekEvent,!1),gecko=!0))}function setStopper(e){stopTime=e}function stopNow2(){timeID=-1,player2.pause(),playing=!1}function playAt(e){player.currentTime=e,slowSeek||player.play()}function playAt2(e){player2.currentTime=e}function play(){player.play()}var originalArray,timeIndexes,currentIndex,id,timeID,missed=0,timesIndex=-1,oldIndex=-2,slowSeek=!1,loadedVar=!1,delay=1500,translationId=null,postPlayBeforeSelectSpeakingQuiz=!1,useAnimation=!0;function stopNowRandom(){stopNow(),quiz||(timeID=setTimeout(randomGenerator,1e3*delay))}function stopAt(e){-1!=timeID&&window.clearTimeout(timeID),timeID=setTimeout(stopNow,1e3*e)}function getName(e){return ie?e.srcElement.name:e.target.getAttribute("name")}function clickOccurred(e,t){var n=getId(e);if(quiz)guess(e,n);else if(showMenu){playAndShow(e),t="<ul><li>"+(t=getTextToDisplay(n,!0,t))+keyPressInfo+"</li></ul>";var i=document.getElementById("context_menu");i.innerHTML=t,i.style.visibility="visible",svg?positionsvg(e,i,2,2):(menuId=getName(e),document.getElementById(n).getAttribute("name"),position(e,i,2,2)),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}}var menuId,quiz=!1;function getId(e){var t=ie?e.srcElement.id:e.target.id;return""==t&&(t=e.target.parentNode.id),-1!=t.indexOf("b")?t.substr(0,t.length-1):t}var messageDiv,longMessageDisplayed,messageDisplayed=!1;function displayMessage(e,t){messageDisplayed?messageDiv=document.getElementById("message"):((messageDiv=document.createElement("div")).setAttribute("id","message"),document.body.appendChild(messageDiv),messageDisplayed=!0),messageDiv.innerHTML=e,messageDiv.style.visibility="visible",setTimeout(hideMessage,t)}function hideLongMessage(){document.getElementById("long_message").style.visibility="hidden",document.onclick=clicked}function displayMessageUntilClick(e){var t=document.getElementById("long_message");null==t&&((t=document.createElement("div")).setAttribute("id","long_message"),document.body.appendChild(t)),t.innerHTML=e,t.style.visibility="visible",window.setTimeout(function(){document.onclick=hideLongMessage},200)}function hideMessage(){messageDiv.style.visibility="hidden"}var lockedID,locked=!1;function unlock(){locked=!1,lockedID=-1}var oldClassName,selectedElem,hidePopupMode=!1;function playSegment(e,t){playSoundSegment(times[e],times[t])}function getTargetElem(e){var t=ie?e.srcElement:e.target;return""==t.id&&(t=e.target.parentNode),t}function selectElem(e){if(null!=selectedElem){if(e==selectedElem)return;selectedElem.className=oldClassName,selectedElem=null}-1==e.className.indexOf(" selected")&&(oldClassName=e.className,e.className=oldClassName+" selected",selectedElem=e)}function selectPlayAndShow(e){var t=getTargetElem(e);selectElem(t);var n=t.id;n||(n=t.parentElement.id),playAndShowId(e,n,!1)}function playAndShow(e){quiz||playAndShowId(e,getId(e),!0)}function playAndShowRow(e,t){quiz||playAndShowId(e,getId(e),t)}function playAndShowParent(e,t){quiz||playAndShowId(e,getParentId(e),t)}var timeIndex=-1;function playAndShowId(e,t,n){var i=parseInt(t),o=times[i];-1!=o&&(locked&&timeIndex===i||(timeIndex=i,locked=!0,lockedID=setTimeout(unlock,300),-1==(i=times[timeIndex+1])&&(i=getNextTime(timeIndex+2)),playSoundSegment(o,i)),hidePopupMode&&(n=!1),n&&(o=(n=document.getElementById("A"+t)).innerHTML,i=n.getAttribute("grammar"),showTranslation&&(null!=(n=document.getElementById("T"+t))&&(o=o+"<br /><em>("+n.innerHTML+")</em>")),showtip(e,o,i)))}function getNextTime(e){for(var t=times[e];-1==t&&e<times.length;)e++,t=times[e];return t}function computeAndGetTranslation(e){if(e=Number(e),"undefined"!=typeof translationMap)for(var t=translationMap.length,n=0;n<t;n++)if(translationMap[n].id===e)return translationId=translationMap[n].tId,document.getElementById("T"+translationId);return translationId=e+1,document.getElementById("T"+translationId)}function getTextToDisplay(e,t,n){var i=(n=n?document.getElementById(e):document.getElementById("A"+e)).innerHTML;return t&&(null==(n=document.getElementById("T"+e))&&(n=computeAndGetTranslation(e)),i=i+" <em>("+n.innerHTML+")</em>"),i}var selectedDiv,selectedTranslationDiv,fieldset,showTranslation=!1;function set(){}function hideDisabledDivs(){if("undefined"!=typeof disabledObjects)for(var e=0;e<disabledObjects.length;e++)document.getElementById(disabledObjects[e]).style.visibility="hidden"}function setDivs(){var e=document.getElementsByTagName("div");if(e){for(var t=[],n=0,i=0;i!=e.length;i++){var o=e[i];"pictorial"==o.getAttribute("class")&&(t[n]=o,n++)}processElements(t),hideDisabledDivs()}}function processElements(e){for(var t=0;t!=e.length;t++)e[t].onmouseover=function(e){playAndShow(e)},e[t].onclick=function(e){clickOccurred(e,!1)},e[t].onmouseout=popDown}function processElement(e){ie&&!html5?(e.onmouseover=playAndShow,e.onclick=function(){clickOccurred(event,!1)}):(e.addEventListener("mouseover",playAndShow,!1),e.onclick=function(e){clickOccurred(e,!1)},e.onmousemove=positiontip),e.onmouseout=popDown}function audioEnd(e){locked=!0,lockedID=setTimeout(unlock,50),null!=selectedElem&&(selectedElem.className=oldClassName,selectedElem=null)}function processHoverElement(e){ie&&!html5?(e.onmouseover=function(e){selectPlayAndShow(e)},e.onclick=function(){clickOccurred(event,!0)},e.onmouseout=popDown):(e.addEventListener("mouseover",function(e){selectPlayAndShow(e)},!1),e.addEventListener("mouseout",audioEnd),e.addEventListener("click",function(e){clickOccurred(e,!0)},!1))}function selectorDiv(e){for(getId(e),e=(selectedDiv=ie?e.srcElement:e.target).id,target.className="audio selected",selectedTranslationDiv=document.getElementById("T"+e),e=parseInt(e);null==selectedTranslationDiv;)e--,selectedTranslationDiv=document.getElementById("T"+e);selectedTranslationDiv.className="translation selected sub"}function selectorTranslation(e){e=getId(e);var t=res=e.slice(1);(selectedDiv=document.getElementById(t)).className="audio selected",(selectedTranslationDiv=document.getElementById(e)).className="translation selected sub"}function selectorOff(){selectedDiv.className="audio",selectedTranslationDiv.className="translation sub"}function selectorOffTrans(){selectedDiv.className="audio",selectedTranslationDiv.className="translation sub"}function selectGroup(e){e=getId(e),null!=(fieldset=document.getElementById("f"+e))&&(fieldset.className="selected")}function selectGroupOff(){null!=fieldset&&(fieldset.className="group")}function processByClass(){if(document.getElementsByClassName){var e=document.getElementsByClassName("hover_title");e&&e.length&&e[0].addEventListener("touchstart",function(){playSound(-1)},!1);var t=document.getElementsByClassName("audio");if(t){for(e=0;e!=t.length;e++)processHoverElement(t[e]);for(t=document.getElementsByClassName("grouplabel"),e=0;e!=t.length;e++)t[e].addEventListener("mouseover",selectGroup,!1),t[e].addEventListener("mouseout",selectGroupOff,!1);for(t=document.getElementsByClassName("sub"),e=0;e!=t.length;e++){var n=t[e];"T"==n.id.slice(0,1)?n.addEventListener("mouseover",selectorTranslation,!1):n.addEventListener("mouseover",selectorDiv,!1),n.addEventListener("mouseout",selectorOff,!1)}}}}function ietruebody(){return document.compatMode&&"BackCompat"!=document.compatMode?document.documentElement:document.body}function popDown(){null!=tip&&(tip.style.visibility="hidden",showing=!1)}var keyPressInfo="";function keyListenerDown(e){ie&&(e=window.event),27==e.keyCode&&(null!=hidePreferences?hidePreferences():exploreToggle())}function keyListener(e){ie&&(e=window.event),113==e.keyCode?toggleQuiz():104==e.keyCode?toggleLabels():32==e.keyCode?speakingQuiz&&(postPlayBeforeSelectSpeakingQuiz?skipForwardSpeakingQuiz():advanceSpeakingQuiz(),e.preventDefault()):45==e.keyCode?0!=(e=player.volume)&&(e=(e-.1).toFixed(1),player.volume=e,displayMessage(setVolumeTo+" "+100*e+"%",3e3)):61==e.keyCode?1!=(e=player.volume)&&(e=(e+.1).toFixed(1),player.volume=e,displayMessage(setVolumeTo+" "+100*e+"%",3e3)):98==e.keyCode?activeBeginnersMode():105==e.keyCode?activeIntermediateMode():97==e.keyCode&&activeAdvancedMode()}var selectedCheckbox,checkmark,currentDifficulty=2,idAssociations=[],reverseIdAssociations=[];function addAssoc(e,t){idAssociations[e]=t;var n=reverseIdAssociations[t];null==n&&(n=[],reverseIdAssociations[t]=n),n.push(e)}function hideDisabledObjects(){if(useSvg&&"undefined"!=typeof disabledObjects)for(var e=disabledObjects.length,t=0;t<e;t++)SVGdoc.hideIdGroup(disabledObjects[t]);else disabledObjects=[]}function activeBeginnersMode(){1==currentDifficulty?subtractDifficulties(i):2==currentDifficulty&&(subtractDifficulties(i),subtractDifficulties(a)),currentDifficulty=0}function activeIntermediateMode(){0==currentDifficulty?addDifficulties(i):2==currentDifficulty&&subtractDifficulties(a),currentDifficulty=1}function activeAdvancedMode(){0==currentDifficulty?(addDifficulties(i),addDifficulties(a)):1==currentDifficulty&&addDifficulties(a),currentDifficulty=2}function setCheckMark(e){var t=document.getElementById("diff-indicator");null!=selectedCheckbox&&(selectedCheckbox.innerHTML=""),0==e?((selectedCheckbox=document.getElementById("beginner_c")).innerHTML="&#10003",t.className="diff beginner"):1==e?((selectedCheckbox=document.getElementById("intermediate_c")).innerHTML="&#10003",t.className="diff intermediate"):((selectedCheckbox=document.getElementById("advanced_c")).innerHTML="&#10003",t.className="diff advanced")}function isNotDisabled(e){return!(-1<disabledObjects.indexOf(e))}function addDifficulties(e){var t,n=e.length;if(useSvg)for(t=0;t<n;t++){var i=e[t];isNotDisabled(i)&&SVGdoc.showIdGroup(i)}for(t=0;t<n;t++)null!=(i=document.getElementById(e[t]))&&(i.style.display="TR"===i.tagName?"table-row":"block")}function subtractDifficulties(e){var t;if(useSvg)for(t=0;t<e.length;t++)SVGdoc.hideIdGroup(e[t]);for(t=0;t<e.length;t++){var n=document.getElementById(e[t]);n&&(n.style.display="none")}}function toggleSpelling(){return hidePopupMode=!hidePopupMode,!0}function toggleAnimation(){return useSvg&&(useAnimation=!useAnimation,SVGdoc.useSelectionAnimation(useAnimation)),!0}function toggleOffensive(e,t){return setCookie("prefs3",e?t+"1":t+"0"),!1}var tip,ns6,ie,showing=!1,offsetfromcursorX=2,offsetfromcursorY=2;function position(e,t,n,i){var o=ns6?e.pageX:event.clientX+ietruebody().scrollLeft,a=ns6?e.pageY:event.clientY+ietruebody().scrollTop,s=ie&&!window.opera?ietruebody().clientWidth:window.innerWidth-20,r=ie&&!window.opera?ietruebody().clientHeight:window.innerHeight-20;r=ie&&!window.opera?r-event.clientY-i:r-e.clientY-i,t.style.left=(ie&&!window.opera?s-event.clientX-n:s-e.clientX-n)<t.offsetWidth?o-t.offsetWidth+"px":o<(n<0?-1*n:-1e3)?"5px":o+n+"px",t.style.top=r<t.offsetHeight?a-t.offsetHeight-i+"px":a+i+"px"}function svgclick(e){if(!quiz){var t=getId(e);menuId=idMappings[parseInt(t)]}clickOccurred(e,!1)}function processAreas(){var e=document.getElementsByTagName("area");if(e)for(var t=0;t!=e.length;t++)processElement(e[t])}function setLangAttribute(){if("undefined"!=typeof language&&"undefined"!=typeof target&&language!==target){for(var e=document.getElementsByClassName("w"),t=0;t!=e.length;t++)e[t].lang=language;for(e=document.getElementsByClassName("hover_title"),t=0;t!=e.length;t++)e[t].lang=language;document.documentElement.lang=target}}function processDivs(){var e=document.getElementsByTagName("div");if(e)for(var t=0;t!=e.length;t++){var n=e[t].getAttributeNode("class");null!=n&&"pictorial"==n.value&&processElement(e[t])}}function processLinks(){var e=document.getElementsByTagName("a");if(e)for(var t=0;t!=e.length;t++){var n=e[t].getAttributeNode("class");null!=n&&("hover"==n.value?processHoverElement(e[t]):"pictorial"==n.value&&processElement(e[t]))}}function initVariables(){ie=document.all,ns6=document.getElementById&&!document.all,"undefined"==typeof staticImage&&(staticImage=!1);var e=localStorage.getItem("spelling");null!==e&&"0"==e&&(hidePopupMode=!0),null!==(e=localStorage.getItem("animation"))&&"0"==e&&(useAnimation=!1)}document.onmousemove=positiontip,function(e){var t=navigator.userAgent.toLowerCase(),n="Microsoft Internet Explorer"==navigator.appName;html5?document.addEventListener("DOMContentLoaded",e,!1):!n&&/mozilla/.test(t)&&!/(compatible)/.test(t)||/opera/.test(t)?document.addEventListener("DOMContentLoaded",e,!1):n?(document.write("<script type='text/javascript' id='contentloadtag' defer='defer' src='javascript:void(0)'><\/script>"),document.getElementById("contentloadtag").onreadystatechange=function(){"complete"==this.readyState&&e()}):window.onload=e}(init);var hasLinks=!0,hasDivs=!0;function init(){document.onclick=clicked,initVariables(),processAreas(),hasDivs&&(processDivs(),setLangAttribute()),hasLinks&&processLinks(),processByClass(),setPlayerVariable(),window.addEventListener("resize",windowResize),document.onkeypress=keyListener,document.onkeydown=keyListenerDown;var e=document.getElementById("quiz");if(null!=e&&(e.checked=!1),"undefined"==typeof useSvg&&(useSvg=!1),useSvg){var t=null;setSvgSize(),window.addEventListener("resize",function(){null!=t&&clearTimeout(t),t=setTimeout(function(){setSvgSize()},500)})}else setDifficulty();createUserDiv(),pointManager=new PointManager}function setSvgSize(){console.log("svg size");var e=document.getElementById("svg");if(e&&"100%"!==e.width){var t=document.documentElement.clientWidth,n=document.documentElement.clientHeight,i=e.scrollHeight,o=e.scrollWidth,a=o/i,s=e.getBoundingClientRect().top+window.scrollY+i;s<n?t<(n=(i+=n-s-27)*a)?setToDefaultDimensions(e,o,a):(e.height=i+"px",e.width=n+"px",null!=(e=document.getElementById("control"))&&(e.style.width=n+"px")):setToDefaultDimensions(e,o,a)}}function setToDefaultDimensions(e,t,n){t<1020&&(e.width="1020px",e.height=1020/n+"px")}function updateDifficultyDisplay(){var e=document.getElementById("difficultyDisplay");null!=e&&(e.innerHTML=getDifficultyDisplayString())}function setDifficulty(){var e=localStorage.getItem("difficulty");"undefined"!=typeof hasDifficulties&&hasDifficulties&&(null!=e&&(0==e?activeBeginnersMode():1==e&&activeIntermediateMode()),updateDifficultyDisplay())}var svgOffsetTop,svgOffsetLeft,SVGdoc,svg=!1,showObjects=!0;function svgInit(e){SVGdoc=e,svg=document.getElementById("svg"),svgOffsetTop=svg.offsetTop,svgOffsetLeft=svg.offsetLeft,null!=svg.offsetParent&&(svgOffsetTop=svg.offsetParent.offsetTop+svgOffsetTop,svgOffsetLeft=svg.offsetParent.offsetLeft+svgOffsetLeft),SVGdoc.showObjectsy(showObjects),2==mode?(SVGdoc.initSpeakingQuiz(idAssociations,reverseIdAssociations),selectSpeakingQuizObject()):1==mode&&listen(),currentDifficulty=2,setDifficulty(),hideDisabledObjects(),useAnimation||SVGdoc.useSelectionAnimation(!1)}function setOldWidth(){svg?(svg.style.position="static",svg.style.border="none",svg.width="956px",svg.height="auto"):null!=content&&(content.style.position="static",content.removeEventListener("touchstart",toggleAdvanceSpeakingQuiz,!1));var e=document.getElementById("modalPage");document.body.removeChild(e),e=document.getElementById("x-out"),document.body.removeChild(e)}function addDarkModel(){var e=document.createElement("div");e.id="modalPage",e.addEventListener("click",exploreToggle),document.body.appendChild(e)}var speakingSvg,activeQuizElements,content=null,firstTimeGuess=!1;function setBestWidth(e){var t=document.createElement("div");t.id="x-out",t.style.top="10px",t.style.right="10px",t.addEventListener("click",exploreToggle),document.body.appendChild(t),addDarkModel(),svg?(t=svg.getBoundingClientRect().right,parseInt(t),t=document.documentElement.clientHeight-55,e?(svg.width=document.documentElement.clientWidth-50+"px",svg.height=t):t/(e=svg.getBoundingClientRect()).height*e.width>document.documentElement.clientWidth?svg.width="100%":(svg.width="auto",svg.height=t),svg.style.position="absolute",svg.style.top="45px",svg.style.left=0,svg.style.right=0,svg.style.margin="auto",svg.style.backgroundColor="white",firstTimeGuess=!0):null!=(content=document.getElementById("content"))&&(content.style.position="absolute",content.style.height=document.documentElement.clientHeight-50+"px",content.style.width="100%",content.style.overflow="auto",content.style.top="50px",content.style.left=0,e&&content.addEventListener("touchstart",toggleAdvanceSpeakingQuiz,!1))}function randomGenerator(){setTimesIndex();var e=times[timesIndex];playAt(e),e=times[letterIndex+1]-e,-1!=timeID&&window.clearTimeout(timeID),timeID=setTimeout(stopNowRandom,1e3*e)}function isActiveSVG(e){if(hasDeactivatedQuizElements&&-1!=deactivatedQuizElements.indexOf(e))return!1;if(1==currentDifficulty){if(-1!=a.indexOf(e))return!1}else if(0==currentDifficulty&&(-1!=a.indexOf(e)||-1!=i.indexOf(e)))return!1;return!0}function isActive(e){if(hasDeactivatedQuizElements&&-1!=deactivatedQuizElements.indexOf(e))return!1;if(hasDifficulties)if(1==currentDifficulty){if(-1!=a.indexOf(e))return!1}else if(0==currentDifficulty&&(-1!=a.indexOf(e)||-1!=i.indexOf(e)))return!1;return!0}function updateActiveQuizElements(){var e=[];for(p=0;p<active.length;p++)if("true"==active[p]){var t=document["group"+p];for(z=0;z<t.length;z++)e.push(times[t[z]])}e.sort()}function createArrayIndexArray(){var e=times.length,t=[];if(svg)for(y=0;y<e-1;y++){var n=times[y];-1!=n&&isActiveSVG(y)&&t.push(y)}else for(y=0;y<e-1;y++)-1!=(n=times[y])&&isActive(y)&&t.push(y);return t}var supportshtml5Audio,quizInited=!1,soundRoot="/static/snd/";function initQuizMode(){createAudioElement("quiz_audio"),createAudioElement("tic")}function createAudioElement(e){var t=document.createElement("audio");(supportshtml5Audio=t.canPlayType)&&(-1==navigator.userAgent.indexOf("Firefox")&&-1==navigator.userAgent.indexOf("Chrome")?t.setAttribute("src",soundRoot+e+".m4a"):t.setAttribute("src",soundRoot+e+".ogg"),t.load(),t.setAttribute("id",e),t.className="pop_up",document.body.appendChild(t))}var hover_over_array,audioHoverOverArray,audioHoverOverArrayText,ctrldown=!1,_quizModeOn=!1;function toggleQuizMode(){_quizModeOn?deactivateQuizMode():activateQuizMode()}function getWordNode(e){if("w"==e.className)return e;for(var t=e.childNodes.length,n=0;n!=t;n++){var i=getWordNode(e.childNodes[n]);if(null!=i)return i}return null}function activateQuizMode(){_quizModeOn=!0,audioHoverOverArray=[],audioHoverOverArrayText=[];var e=document.getElementsByClassName("audio");if(e)for(var t=e.length,n=0;n!=t;n++){var i=getWordNode(e[n]);null!=i&&(audioHoverOverArrayText.push(i.innerHTML),audioHoverOverArray.push(i),i.innerHTML="******")}if(hover_over_array=[],e=document.getElementsByTagName("a"))for(n=0;n!=e.length;n++)"hover"==(t=e[n]).getAttribute("class")&&(hover_over_array.push(t.innerHTML),t.innerHTML="******")}function deactivateQuizMode(){_quizModeOn=!1;var e=0,t=document.getElementsByTagName("a");if(t){for(var n=0;n!=t.length;n++){var i=t[n];"hover"==i.getAttribute("class")&&(i.innerHTML=hover_over_array[e],e++)}for(e=audioHoverOverArray.length,n=0;n!=e;n++)audioHoverOverArray[n].innerHTML=audioHoverOverArrayText[n]}}var checkmarkNode,previouslyCheckedDiv,mode=0,buttonControlId="buttonControl";function changeModeSelection(){var e=document.getElementById("explore");null==previouslyCheckedDiv&&(previouslyCheckedDiv=e);var t=previouslyCheckedDiv.textContent;previouslyCheckedDiv.textContent="",0!=mode&&(e=1==mode?document.getElementById("listen"):document.getElementById("speak")),e.textContent=t,previouslyCheckedDiv=e}function createButton(e,t,n,i){var o=document.createElement("button");return null!=i&&o.setAttribute("style",i),o.setAttribute("readonly","readonly"),o.addEventListener("click",t,!1),o.innerHTML=e,n.appendChild(o),o}function createButtonWithId(e,t,n,i,o){return(e=createButton(e,n,i,o)).id=t,e}var quizModeHelpMsg="Click on the image that corresponds best to the word you hear.";function helpListen(){displayMessage(quizModeHelpMsg,4e3)}function surrender(){alert("surrender")}function replay(){playLetter()}function skip(){alert("skip")}function showSpelling(){alert("showSpelling")}function removeButtonControlPanel(){var e=document.getElementById(buttonControlId);e.parentNode.removeChild(e)}function emptyButtonControlPanel(){var e=document.getElementById(buttonControlId);return e.innerHTML="",e}function createButtonControlPanel(){var e=document.getElementById("nav");null==e&&(e=document.getElementById("control"));var t=document.createElement("div");return t.id="buttonControl",e.parentNode.insertBefore(t,e.nextSibling),null!=(e=document.getElementById("svg"))&&(e.style.marginTop="4px"),t}function listen(){if(1!=mode){setBestWidth(!0),initListeningQuiz();var e=2==mode?emptyButtonControlPanel():createButtonControlPanel();mode=1,createButton(generateButtonHtml("help.png",32,32),helpListen,e,"margin: 0 20px 0 0;padding: 6px;"),createButton("show spelling",quizShowSpelling,e,"font-size: 125%;padding:10px 12px 11px; "),createButton(generateButtonHtml("skip_forward.png",32,32),quizSkip,e,"margin: 0 20px; padding: 6px 0 6px"),createButton("replay "+generateButtonHtml("sound.png",13,18),replay,e,"margin: 0 20px 0 0;font-size: 125%;padding:10px 12px 11px"),pointManager.loadListeningPointsFromLocalStorage(),activateQuiz(),pointManager.startPointSavingTimer()}}function explore(){0!=mode&&(2==mode?turnOffQuizMode():quiz=!1,mode=0,removeButtonControlPanel(),pointManager.cancelPointSavingTimer())}function helpSpeaking(){displayMessage(speakingQuizStartMsg,4e3)}var speakingQuizHistory,advanceButton,skipForwardButton,paused=!1,speakingQuizElementSelected=!1;function pauseSpeakingQuiz(){clearTimeout(speakingQuiztimeoutID),document.getElementById("pause").innerHTML=generateButtonHtml("9-av-play.png",32,32,null),paused=!0}function toggleAdvanceSpeakingQuiz(){postPlayBeforeSelectSpeakingQuiz||advanceSpeakingQuiz()}function advanceSpeakingQuiz(){pointManager.recordSpeakingCorrect(timesIndex),playLetter()}function skipForwardSpeakingQuiz(){-1!=speakingQuiztimeoutID&&window.clearTimeout(speakingQuiztimeoutID),-1!=timeID&&(window.clearTimeout(timeID),stopSimple()),player.pause(),playing=!1,selectNextSpeakingQuizElement()}function skipBackwardsSpeakingQuiz(){}function toggleSpeakingQuiz(){paused?(clearTimeout(speakingQuiztimeoutID),paused=!1,postPlayBeforeSelectSpeakingQuiz?selectNextSpeakingQuizElement():(playLetter(),speakingQuizElementSelected=!1),document.getElementById("pause").innerHTML=generateButtonHtml("9-av-play.png",32,32)):pauseSpeakingQuiz()}function toggleHelpSpeaking(){displayMessageUntilClick(speakingQuizHelp)}function speak(){if(2!=mode){-1!=timeID&&(clearTimeout(timeID),stopSimple()),setBestWidth(!0);var e=1==mode?emptyButtonControlPanel():createButtonControlPanel();svg&&(staticImage?SVGdoc.initSpeakingQuiz():SVGdoc.initSpeakingQuiz(idAssociations,reverseIdAssociations)),speakingQuizHistory=[],speakingQuizInitedFirstTime=!0,mode=2,createButton(generateButtonHtml("help.png",32,32),helpSpeaking,e,"padding: 8px;margin-right: 20px;"),(advanceButton=createButtonWithId(generateButtonHtml("9-av-play.png",32,32),"advance",advanceSpeakingQuiz,e,null)).className="focus",skipForwardButton=createButtonWithId(generateButtonHtml("skip_forward.png",32,32),"skip_forward",skipForwardSpeakingQuiz,e,"padding: 8px;"),pointManager.loadSpeakingPointsFromLocalStorage(),startSpeakingQuiz(),pointManager.startPointSavingTimer()}}function generateButtonHtml(e,t,n){return'<img src="/static/images/'+e+'" align="absmiddle" width="'+t+'" height="'+n+'" />'}function activateQuiz(){speakingQuiz&&turnOffQuizMode(),startQuiz(),quizInited||(quizInited=!0,setTimeout(initQuizMode,1500))}function hideElement(e){document.getElementById(e).style.visibility="hidden"}function startQuiz(){null!=speakingQuiz&&clearQuizTimeout(),quiz=!0,null==originalArray&&(originalArray=createArrayIndexArray()),timeIndexes=originalArray.slice(),setTimeIndex(),playSound(timesIndex)}function toggleSpeakingQuiz(){speakingQuiz?turnOffQuizMode():startSpeakingQuiz()}function turnOffQuizMode(){quiz=speakingQuiz=!1,svg&&(SVGdoc.deactivateSpeakingQuiz(),document.body.style.backgroundColor="rgba(255,255,255,1)"),-1!=speakingQuiztimeoutID&&clearTimeout(speakingQuiztimeoutID),deselectSpeakingQuizElement()}function clearQuizTimeout(){-1!=timeID&&(window.clearTimeout(timeID),stopNow())}function windowResize(){svgOffsetTop=svg.offsetTop,svgOffsetLeft=svg.offsetLeft,null!=svg.offsetParent&&(svgOffsetTop=svg.offsetParent.offsetTop+svgOffsetTop,svgOffsetLeft=svg.offsetParent.offsetLeft+svgOffsetLeft)}var speakingQuiz=!1;function startSpeakingQuiz(){quiz=speakingQuiz=!0,paused=!1,clearQuizTimeout(),null==originalArray&&(originalArray=createArrayIndexArray()),timeIndexes=originalArray.slice(),pointManager.removedAlreadyGuessedSpeaking(timeIndexes),selectNextSpeakingQuizElement()}function deselectSpeakingQuizElement(){hasSelectedElement&&(svg?SVGdoc.hideGuess(timesIndex):speakingQuizSelectedElement.className=previousClassName,hasSelectedElement=!1)}function initSelectSpeakingQuizObject(){advanceButton.disabled=!1,advanceButton.className="focus",skipForwardButton.className="",postPlayBeforeSelectSpeakingQuiz=!1,speakingQuiztimeoutID=-1,deselectSpeakingQuizElement(),speakingQuizInitedFirstTime?speakingQuizInitedFirstTime=!1:speakingQuizHistory.push(currentIndex)}function selectSpeakingQuizObject(){svg?SVGdoc.guess(timesIndex):(speakingQuizSelectedElement=document.getElementById(timesIndex),previousClassName=speakingQuizSelectedElement.className,speakingQuizSelectedElement.className+=" quiz_selected"),hasSelectedElement=!0}var speakingQuizSelectedElement,previousClassName,hasSelectedElement,speakingQuizInitedFirstTime,speakingQuizHistoryIndex,skipBackwardSpeakingQuizButton,microphoneListenMode=!1;function selectNextSpeakingQuizElement(){paused||(initSelectSpeakingQuizObject(),setTimeIndex(),removeTime(currentIndex),selectSpeakingQuizObject()),null!=recognition&&(console.log("start"),recognition.start())}function selectSpeakingQuizElementFromHistory(){paused||(initSelectSpeakingQuizObject(),-1!=speakingQuizHistoryIndex&&(speakingQuizHistoryIndex=speakingQuizHistory.length),0==--speakingQuizHistoryIndex&&(skipBackwardSpeakingQuizButton.disabled=!0),timesIndex=timeIndexes[speakingQuizHistory[speakingQuizHistoryIndex]],selectSpeakingQuizObject())}function setTimeIndex(){var e=timeIndexes.length;for(1!=e&&0==e&&(playAudio("tic"),1===mode?pointManager.markListeningFinished(congratulationsMsg):pointManager.markSpeakingFinished(congratulationsMsg),missed=0,e=(timeIndexes=originalArray.reverse()).length),currentIndex=Math.floor(Math.random()*e),timesIndex=timeIndexes[currentIndex];oldIndex==timesIndex&1<e;)currentIndex=Math.floor(Math.random()*e),timesIndex=timeIndexes[currentIndex];oldIndex=timesIndex}function playLetter(){speakingQuiz&&(null!=recognition&&recognition.abort(),skipForwardButton.className="focus",advanceButton.disabled=!0,advanceButton.className="",postPlayBeforeSelectSpeakingQuiz=!0),playSound(timesIndex)}function removeTime(e){var t=timeIndexes.slice(0,e);e=timeIndexes.slice(e+1,timeIndexes.length),timeIndexes=t.concat(e)}function hideCheckmark(){checkmark.style.visibility="hidden"}function hideWrong(){document.getElementById("wrong").style.visibility="hidden"}function indicateCorrectAnswer(e){checkmark.style.visibility="visible",svg?positionsvg(e,checkmark,-40,-40):position(e,checkmark,-40,-40),setTimeout(hideCheckmark,1e3)}function initListeningQuiz(){null==(checkmark=document.getElementById("checkmark"))&&((checkmark=document.createElement("img")).setAttribute("id","checkmark"),checkmark.setAttribute("src","/static/images/green_checkmark.png"),checkmark.setAttribute("style","position:absolute;z-index:23"),document.body.appendChild(checkmark),hideCheckmark());var e=document.getElementById("wrong");null==e&&((e=document.createElement("img")).setAttribute("id","wrong"),e.setAttribute("src","/static/images/wrong.png"),e.setAttribute("style","position:absolute; z-index:23"),document.body.appendChild(e),hideWrong())}function indicateIncorrectAnswer(e){wrong.style.visibility="visible",svg?positionsvg(e,wrong,-40,-40):position(e,wrong,-40,-40),setTimeout(hideWrong,1e3)}function playAudio(e){null!=(e=document.getElementById(e))&&(e.currentTime=0,e.play())}var points=0,missedLastOne=!1;function guess(e,t){timesIndex==t?(indicateCorrectAnswer(e),missedLastOne?missedLastOne=!1:(removeTime(currentIndex),pointManager.recordListeningCorrect(t)),setTimeIndex(),playSound(timesIndex)):(missedLastOne=!0,playAudio("quiz_audio"),indicateIncorrectAnswer(e),missed++)}function playChain(){}function playSound(e){if(-1!=timeID&&(window.clearTimeout(timeID),timeID=-1,player.pause()),-1==e){if(quiz)return;var t=0}else t=times[e];e=getValidEndTime(e)-t-subtractBy,slowSeek?(setStopper(1e3*e),playAt(t)):(playAt(t),timeID=setTimeout(stopNow,1e3*e))}function getValidEndTime(e){e++;for(var t=times[e++];-1==t&&e<times.length;)t=times[e],e++;return t}function playSoundSegment(e,t){-1!=timeID&&(window.clearTimeout(timeID),stopNow()),t=t-e-subtractBy,slowSeek?(setStopper(1e3*t),playAt(e)):(playAt(e),timeID=setTimeout(stopNow,1e3*t))}var req,options,showingAward=!1,onCloseCallback=null;function addOnCloseCallback(e){onCloseCallback=e}function clicked(){if(showingAward){var e=document.getElementById("modalPage");document.body.removeChild(e),e=document.getElementById("award");var t=document.getElementById("victory");t.pause(),document.body.removeChild(e),document.body.removeChild(t),showingAward=!1,null!=onCloseCallback&&(onCloseCallback(),onCloseCallback=null)}if("visible"==(e=document.getElementById("context_menu")).style.visibility)return e.style.visibility="hidden",!0;null!=options&&"visible"==options.style.visibility&&(options.style.visibility="hidden")}function saveItem(){storeWord(),document.getElementById("context_menu").style.visibility="hidden"}function storeWord(){var e="/user/save_word.jsp?target="+target+"&lang="+language+"&id="+menuId;null!=translationId&&(e+="&translationId="+document.getElementById(translationId).name,translationId=null);"undefined"!=typeof XMLHttpRequest?req=new XMLHttpRequest:window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP")),req.open("GET",e,!0),req.onreadystatechange=callback,req.send(null)}function quizSkip(){removeTime(currentIndex),setTimeIndex(),playSound(timesIndex)}function quizShowSpelling(){displayMessage(document.getElementById("A"+timesIndex).innerHTML,2e3)}function display(){}function callback(){4==req.readyState&&(200==req.status?null!=req.responseXML&&"invalid"==req.responseXML.getElementsByTagName("message")[0].childNodes[0].value&&alert("Please login. Click on 'My Account' to get a login prompt."):alert("Please login. Click on 'My Account' to get a login prompt."+req.status))}function toggleDisplayOptions(e,t){if(null==options||"visible"!=options.style.visibility||(options.style.visibility="hidden",options.id!=t)){for(var n=document.getElementById(t+"Button"),i=n.offsetHeight,o=0;null!=n;)i+=n.offsetTop,o+=n.offsetLeft,n=n.offsetParent;(options=document.getElementById(t)).style.top=i+"px",options.style.left=o+"px",options.style.visibility="visible",e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}}var hasGroups=!1;function remove(e){if(useDiscreteElements){var t=[];if(0==(e=range(e)).length)for(var n=1;n<range.length;n++)for(e=range[n],z=0;z<e.length;z++)value=currentArray[e[z]],t.push(value);else for(n=start=0;n<e.length;n++){for(value=e[n],z=start;z<value;z++)toSave=currentArray[z],t.push(toSave);start=z+1}currentArray=t}}function addRanges(e,t){for(;e<t;e++)currentArray.push(e)}function add(e){if(0==e){addRanges(0,range[e]);for(var t=0;t<range[e];t++){var n="letter"+t;document.getElementById(n).style.visibility="visible"}}else for(start=0==e?0:range[e-1],addRanges(start,range[e]),t=start;t<range[e];t++)n="letter"+t,_slideshow||(document.getElementById(n).style.visibility="visible")}function changeGroup(e){active[e.value]=!!e.checked,updateActiveQuizElements()}function setCookie(e,t,n){var i=new Date;i.setDate(i.getDate()+n),t=escape(t)+(null==n?"":"; expires="+i.toUTCString())+"; path=/",document.cookie=e+"="+t}function removeCookie(e){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/"}function getCookie(e){var t,n=document.cookie.split(";");for(t=0;t<n.length;t++){var i=n[t].substr(0,n[t].indexOf("=")),o=n[t].substr(n[t].indexOf("=")+1);if((i=i.replace(/^\s+|\s+$/g,""))==e)return unescape(o)}}var launchMicHTML,recognition,suggestionExpanded=!(active=[]);function expandSuggestions(){var e=document.getElementById("suggest"),t=document.getElementById("suggestSymbol");suggestionExpanded?(e.style.display="none",suggestionExpanded=!1,t.innerHTML="+"):(suggestionExpanded=!0,e.style.display="block",t.innerHTML="-")}function showtip(e,t,n){(tip=document.getElementById("popup")).innerHTML=t,tip.style.visibility="visible",null!=n&&(tip.style.backgroundColor="m"==n?"#DDDDFF":"f"==n?"#FFDDDD":"#DDFFDD"),showing=!0,svg?positiontipsvg(e):position(e,tip,10,20)}function positiontipsvg(e){showing&&(tip.style.top=e.clientY+svgOffsetTop+10+"px",tip.style.left=e.clientX+svgOffsetLeft+20+"px")}function positionsvg(e,t,n,i){t.style.top=e.clientY+svgOffsetTop+n+"px",t.style.left=e.clientX+svgOffsetLeft+i+"px"}function positiontip(e){showing&&position(e,tip,10,20)}function speakToggle(){2!=mode&&speak()}function exploreToggle(){0!=mode&&(setOldWidth(),explore())}function listenToggle(){1!=mode&&listen()}function upgrade(){alert("Use of microphone only supported in webkit browsers (safari, chrome, chromium).")}function setUpMicrophoneLaunchIcon(){document.getElementById("mic").innerHTML=launchMicHTML}function toggleMicrophone(){microphoneListenMode?(setUpMicrophoneLaunchIcon(),recognition.abort(),microphoneListenMode=!1):launchMicrophone()}function speakToMicrophone(){playLetter()}function launchMicrophone(){"webkitSpeechRecognition"in window?(microphoneListenMode=!0,document.getElementById("mic"),(recognition=new webkitSpeechRecognition).continuous=!0,recognition.requiredConfidence=.1,recognition.interimResults=!1,recognition.lang=language,alert(recognition.lang),recognition.onstart=function(){console.log("on start"),hideMessage();var e=document.getElementById("mic");launchMicHTML=e.innerHTML,e.innerHTML=generateButtonHtml("mic_record.png",38,38,"margin-left: 20px;padding:2px 4px")},recognition.onresult=function(e){for(var t=e.resultIndex;t<e.results.length;++t)e.results[t].isFinal&&(final_transcript+=e.results[t][0].transcript,console.log("result in"),postPlayBeforeSelectSpeakingQuiz||playLetter())},recognition.onerror=function(e){console.log(""+e.error)},recognition.onend=function(){console.log("on end"),setUpMicrophoneLaunchIcon(),advanceButton.focus()},final_transcript="",console.log("prepare for launch"),recognition.start(),displayMessage("Please use headphones when using this feature.  Say the word for the selected image. Your voice will be detected and the correct answer will be spoken",1e4)):upgrade()}var pointsDiv,useLocalPoints=!0;function initPoints(e){points=parseInt(e),(pointsDiv=document.getElementById("points")).innerHTML=points}var userDiv,gameActivated=!1;function createUserDiv(){"1"===localStorage.getItem("game")&&"undefined"!=typeof language&&"en"==language&&(gameActivated=!0,(userDiv=document.createElement("div")).id="user_div",userDiv.setAttribute("style","position:absolute;right: 0px; top:0;padding:6px;text-align:right;"),(pointsDiv=document.createElement("div")).id="points",pointsDiv.addEventListener("click",function(){window.location.href="/user/points.jsp?lang="+language}),document.body.appendChild(pointsDiv))}function userCallback(){if(4==req.readyState&&200==req.status){var e=document.getElementsByTagName("body")[0];if(e=null!=target&&"en"!==target?"?target="+target:"","{}"!=req.responseText){var t=req.responseText,n=t.indexOf("^");if(-1!=n){var i=t.substr(0,n);t.substr(n+1,t.length-1)}else i=t;(t=document.createElement("div")).id="user2Button",t.className="optionsButton",t.addEventListener("click",function(){toggleDisplayOptions(event,"user2",!0)},!1),t.innerHTML=+i+'<img src="static/images/down_arrow.png" width="10" height="6">',(i=document.createElement("div")).setAttribute("class","options"),i.id="user2",(t=document.createElement("div")).setAttribute("onclick","location.href='/user/account.jsp"+e+"'"),t.setAttribute("class","option link"),t.innerHTML=savedWords,i.appendChild(t),(t=document.createElement("div")).innerHTML=logout,t.setAttribute("class","option link"),t.setAttribute("onclick","location.href='/user/logout.jsp"+e+"'"),i.appendChild(t),(e=document.getElementsByTagName("body")[0]).appendChild(i),registerVisit()}}}function loadUserInfo(){"undefined"!=typeof XMLHttpRequest?req=new XMLHttpRequest:window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP")),req.open("GET","/user/getUserName.jsp",!0),req.onreadystatechange=userCallback,req.send(null)}var visitId,alreadyScored,registeredVisit=!1;function visitRegistered(){if(4==req.readyState&&200==req.status){var e=req.responseText,t=e.indexOf("-");-1!=t?(visitId=e.substr(0,t),e=e.substr(t+1,e.length-1),(alreadyScored=[]).push.apply(alreadyScored,e.split(",").map(Number))):(visitId=e,alreadyScored=[]),registeredVisit=!0}}function registerVisit(){if("undefined"!=typeof lgname){var e="/user/visit.jsp?c="+lgname+"&n="+number+"&t="+target+"&l="+language;"undefined"!=typeof XMLHttpRequest?req=new XMLHttpRequest:window.ActiveXObject&&(req=new ActiveXObject("Microsoft.XMLHTTP")),req.open("GET",e,!0),req.onreadystatechange=visitRegistered,req.send(null)}}function answerRegistered(){}var correctGuesses=[],correctSpeakingGuesses=[],pointManager=null;function PointManager(){function a(e){var t=localStorage.getItem("awards");null!=t?(awardArray=JSON.parse(t),void 0===awardArray[language]&&(awardArray[language]=[])):(awardArray={},awardArray[language]=[]),awardArray[language].push(e),e=JSON.stringify(awardArray),localStorage.setItem("awards",e)}function t(){var e=!1;if("undefined"!=typeof award&&(s(lgname,award.desc),a(lgname),e=!0),"undefined"!=typeof group){for(var t="g-"+group.name+"-"+language,n=localStorage.getItem(t),i="",o=0;o<group.total;o++)i+="1";if(null==n)for(n="",o=0;o<group.total;o++)n=o==group.index?n+"1":n+"0";else o=0,o=n.substring(0,group.index)+1,group.total>group.index+1&&(o+=n.substring(group.index+1,n.length)),n=o;localStorage.setItem(t,n),n==i&&(a(group.name),e?addOnCloseCallback(function(){s(group.name,group.desc)}):s(group.name,group.desc))}}function s(e,t){if(gameActivated){var n=document.createElement("div");t="<div>"+t+"</div>\t",n.id="award",n.style.height="300px",n.style.top=0,n.style.backgroundColor="#4b7aa4",n.style.display="table-cell",n.style.verticalAlign="middle",n.style.bottom=0;var i=document.createElement("div"),o=document.createElement("div");o.style.height="100%",o.style.verticalAlign="middle",i.id="modalPage",document.body.appendChild(i),showingAward=!0,n.style.left=0,n.style.right=0,n.style.width="300px",n.style.margin="auto",n.style.paddingTop="10px",n.style.color="white",n.style.padding="14px;",n.style.position="absolute",n.style.borderRadius="140px",n.style.zIndex=200,n.innerHTML='<img src="/images/awards/'+e+'.png"  /><div style="width:200px; margin:auto">'+t+'</div><div style="margin-top:10px;"><img src="static/images/x.png" width="40" height="40" /></div>',document.body.appendChild(n),createAudioElement("victory"),playAudio("victory")}}function n(){var e=document.getElementById("listen"),t=e.innerHTML;e.style.paddingRight="24px",e.innerHTML=t+I}function i(){var e=document.getElementById("speak");e.style.paddingRight="28px",e.innerHTML+=I}function o(e,t){var n=localStorage.getItem(p);if(null!=n){var i=parseInt(n);i+=e,localStorage.setItem(p,""+i)}else localStorage.setItem(p,e);gameActivated&&(pointsDiv.innerHTML=i,0<e&&(t+=" You just earned "+e+" points.")),displayMessage(t,4e3)}var r,l,d,c,u=!1,g=!1,m=!1,e=null,p="points-"+language,f=lgname+"-"+language,v="lpoints-"+f,y="spoints-"+f;this.resetPoints=function(){localStorage.clear()},this.processGroup=function(){t()},this.markListeningFinished=function(e){k||(k=!0,o(l,e),l=0,localStorage.setItem(y,0),h?(localStorage.setItem(f,"3"),t()):localStorage.setItem(f,"1"),n())};var h,k,I='<object data="/images/checkmark.svg" type="image/svg+xml" width="40px" height="40px" class="cm"> </object>';this.markSpeakingFinished=function(e){h?displayMessage("Starting over...",2e3):(h=!0,o(d,e),d=0,localStorage.setItem(y,d),k?(localStorage.setItem(f,"3"),t()):localStorage.setItem(f,"2"),i())},this.removedAlreadyGuessedSpeaking=function(e){var t=correctSpeakingGuesses.length;if(0<t&&e.length!==t)for(var n=0;n<t;n++){var i=e.indexOf(correctSpeakingGuesses[n]);e.splice(i,1)}},this.startPointSavingTimer=function(){null==e&&(e=window.setInterval(this.savePointsLocally,1e3))},this.cancelPointSavingTimer=function(){clearInterval(e),e=null,this.savePointsLocally()},this.savePointsLocally=function(){if(u){if(u=!1,m){localStorage.setItem(y,d),m=!1;var e=JSON.stringify(correctSpeakingGuesses);localStorage.setItem(r,e)}g&&(localStorage.setItem(v,l),g=!1,e=JSON.stringify(correctGuesses),localStorage.setItem(c,e))}},this.loadPointsFromLocalStorage=function(){var e=localStorage.getItem(p),t=localStorage.getItem(f);null!=t&&(1==t?(n(),k=!0):2==t?(i(),h=!0):3==t&&(n(),i(),k=h=!0)),t=localStorage.getItem(y),d=null!=t?new Number(t):0,t=localStorage.getItem(v),l=null!=t?new Number(t):0,"undefined"!==e&&"NaN"!==e?points=new Number(e):(points=0,localStorage.setItem(p,"0")),gameActivated&&(pointsDiv.innerHTML=points)},this.loadListeningPointsFromLocalStorage=function(){c=f+"-clg";var e=localStorage.getItem(c);correctGuesses=null!=e?JSON.parse(e):{}},this.loadSpeakingPointsFromLocalStorage=function(){r=f+"-csg";var e=localStorage.getItem(r);correctSpeakingGuesses=null!=e?JSON.parse(e):[]},this.recordSpeakingCorrect=function(e){h||-1!=correctSpeakingGuesses.indexOf(e)||(d+=1,u=!0,correctSpeakingGuesses.push(e),m=!0)},this.recordListeningCorrect=function(e){1!=correctGuesses[e]&&(l+=2,u=!0,correctGuesses[e]=1,g=!0)},this.loadPointsFromLocalStorage()}function toggleDisplayOptions(e,t,n){if(null==options||"visible"!=options.style.visibility||(options.style.visibility="hidden",options.id!=t)){for(var i=document.getElementById(t+"Button"),o=i.offsetHeight;null!=i;)o+=i.offsetTop,i=i.offsetParent;(options=document.getElementById(t)).style.top=o+"px",n&&(options.style.right=0),options.style.visibility="visible",e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}}function getDifficultyDisplayString(){return 0===currentDifficulty?beginner:1===currentDifficulty?intermediate:advanced}var hidePreferences=null;function launchPreferences(){var e=null,t=document.createElement("div");t.id="modalPage",document.body.appendChild(t);var n=document.createElement("div");n.id="preferences",document.body.appendChild(n),createOptionRowFromStorage("spelling",n,spelling,toggleSpelling),createOptionRowFromStorage("animation",n,showAnimationText,toggleAnimation),e=document.createElement("div"),"undefined"!=typeof difficulty&&(e.innerHTML=difficulty),e.style.marginTop="10px",e.style.borderBottom="1px solid black",n.appendChild(e),createRadioRow("difficulty","b",n,beginner),createRadioRow("difficulty","i",n,intermediate),createRadioRow("difficulty","a",n,advanced),createOptionRowFromCookie("offensive",n,showOffensiveContent,toggleOffensive),(e="0"===(e=localStorage.getItem("difficulty"))?document.getElementById("b"):"1"===e?document.getElementById("i"):document.getElementById("a")).checked=!0;var i=document.createElement("div");i.id="x-out2",document.body.appendChild(i),hidePreferences=function(e){document.body.removeChild(n),document.body.removeChild(i),document.body.removeChild(t),hidePreferences=null},t.addEventListener("click",hidePreferences,!1),i.addEventListener("click",hidePreferences,!1)}function createOptionRow(e,t,n,i){var o=document.createElement("div");return o.id=t+"row",e.appendChild(o),(e=document.createElement("input")).type="checkbox",e.name=t,e.id=t,e.checked=i,e.style.pointerEvents="none",o.appendChild(e),(t=document.createElement("label")).innerHTML=n,o.appendChild(t),o}function createOptionRowFromStorage(n,e,t,i){var o=localStorage.getItem(n);null==o||"1"==o?(e=createOptionRow(e,n,t,!0),document.getElementById(n).checked=!0):e=createOptionRow(e,n,t,!1),e.addEventListener("click",function(){var e=document.getElementById(n),t=i(!e.checked);e.checked?(e.checked=!1,t&&localStorage.setItem(n,"0")):(e.checked=!0,t&&localStorage.setItem(n,"1"))},!1)}function createOptionRowFromCookie(n,e,t,i){var o=!1,a=getCookie("prefs3");null!=a&&"1"==a.substring(2,3)&&(o=!0),(e=createOptionRow(e,n,t,o)).style.borderTop="1px solid black",e.addEventListener("click",function(){var e=document.getElementById(n),t=a.substring(0,2);i(!o,t),e.checked=!e.checked},!1)}function createRadioRow(e,t,n,i){var o=null,a=document.createElement("div");a.id=t+"-row",n.appendChild(a),(n=document.createElement("input")).type="radio",n.name=e,n.id=t,n.value=e,a.appendChild(n),(e=document.createElement("label")).innerHTML=i,a.appendChild(e),a.addEventListener("click",function(){"b-row"==a.id?(o=document.getElementById("b"),localStorage.setItem("difficulty","0"),activeBeginnersMode()):"i-row"==a.id?(o=document.getElementById("i"),localStorage.setItem("difficulty","1"),activeIntermediateMode()):"a-row"==a.id&&(o=document.getElementById("a"),localStorage.setItem("difficulty","2"),activeAdvancedMode()),updateDifficultyDisplay(),o.checked=!0},!1)}