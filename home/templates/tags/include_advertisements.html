{% load site_tags %}
<script id="script-{{ id }}">
	let ad_elements = [
		{% for ad in ads %}
			$("<div id='{{ ids|index:forloop.counter0 }}' style='margin-bottom:20px'></div>"),
		{% endfor %}
	];
	let parent_contaner = $('#script-{{ id }}').parent();
	for (let i = 0; i < ~~parent_contaner.height()/800 && i < ad_elements.length; i++){
		parent_contaner.append(ad_elements[i]);
	}

</script>
<script>
    var gptadslots = [];
    var googletag = googletag || {cmd:[]};
</script>
<script>
	googletag.cmd.push(function ()
	{{% for ad in ads %}
		gptadslots.push(googletag.defineSlot('/21671132665/{{ ad.adunit_code }}', {{ ad.adunit_sizes }}, '{{ ids|index:forloop.counter0 }}').addService(googletag.pubads()));
	{% endfor %}
	});

	googletag.pubads().enableLazyLoad({
    		fetchMarginPercent: 500,
    		renderMarginPercent: 200,
    		mobileScaling: 2.0
  		});
	googletag.enableServices();

	let adunits = document.querySelectorAll('div[id^="{{ id }}-"]');
  for (let i = 0; i < adunits.length; i++)
  { googletag.cmd.push(function() {googletag.display(adunits[i].getAttribute('id'));}); }

</script>
