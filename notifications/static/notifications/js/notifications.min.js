var notificationsUpdateDatetime=0;function ifHasNewNotification(a){$.ajax(Urls["notifications:has_new_notifications"](),{type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({datetime:notificationsUpdateDatetime}),success:function(b){b.hasNewNotifications?a.call():b.hasNewNotifications||$("#notify-badge-nav").html("0").hide()}})}
function updateBadge(){$.ajax({url:Urls["notifications:get_new_count"](),success:function(a){0<a?($("#notify-badge-nav").html(a).show(),notificationsUpdateDatetime=Date.now()):$("#notify-badge-nav").html(a).hide()}})}
window.setBadgeUpdater=function(a){var b={interval:a,stopTime:void 0,callback:function(){ifHasNewNotification(updateBadge)},stopped:!1,runLoop:function(){b.stopped||(b.callback.call(this),b.loop())},stop:function(){this.stopped||(this.stopped=!0,window.clearTimeout(this.timeout),this.stopTime=Date.now())},start:function(a){this.stopped=!1;Date.now()-this.stopTime>this.interval?this.callback.call(this):a&&this.callback.call(this);return this.loop()},loop:function(){this.timeout=window.setTimeout(this.runLoop,
this.interval);return this}};return b.start(!0)};$(document).ready(function(){$(".notify-dropdown").on("click",get_drop_content);var a=setBadgeUpdater(6E4);document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?a.start():a.stop()})});function check_notifications(a){0<a.length&&($("#notify-badge-nav").hide().html("0"),$.ajax(Urls["notifications:check_list"](),{type:"POST",data:{pks:a.toString()}}))}
function get_drop_content(){$(".notify-drop > .drop-content").replaceWith($("<div class=\"drop-content\"><img src='/static/images/loading_icon.gif'></div>"));$.ajax(Urls["notifications:get_drop_content_html"](),{data:{path:window.location.pathname},success:function(a){$(".notify-drop > .drop-content").replaceWith(a);$(".dropdown-menu .notify").click(function(a){$(a.target).is("a")||(window.location.href=this.getAttribute("data-url"))});var b=[];$("*[data-check_datetime='None']").each(function(){b.push(this.dataset.pk)});
check_notifications(b)}})};
