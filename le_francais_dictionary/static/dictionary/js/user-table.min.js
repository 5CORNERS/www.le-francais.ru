var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
var dt,$globalCheckbox,$selectStars,$table=$("#wordsTable"),style=getComputedStyle(document.body),checked_ids=[];function showDeleted(a){a?dt.api().column(2).search("^True|False$",!0,!1).draw():dt.api().column(2).search("^False$",!0,!1).draw()}function emptyTable(a){$table.find("tbody").empty().html('<tr><td colspan="5" style="text-align:center">'+a+"</td></tr>")}
function errorLoading(){emptyTable('<div class="row"><div class="col-12"><h5 style="margin:1rem">\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043b\u043e\u0432 :(</h5></div> </div>')}
function tableReloading(){$table.find("tbody").empty().html('<tr><td colspan="5" style="text-align:center"><div class="row"><div class="col-12"><h5 style="margin:1rem">\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0441\u043b\u043e\u0432\u0430...</h5></div><div class="col-12"><img src="/static/images/loading_icon.gif"></div></div></td></tr>')}
var tableFiltersInit={beforeLoad:{},afterLoad:{},selectAfterFilter:{}},tableFilters=tableFiltersInit.valueOf(),tableFiltersLoaded=!1,savingFiltersEnabled=!0,loadFilterButton={init:function(){this.$button=$("#getAndApplyFilters");this.$button.on("click",this.loadAndFilter);this.readyText="\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044e\u044e \u0432\u044b\u0431\u043e\u0440\u043a\u0443";this.loadingText='<i class="fa fa-sync fa-spin"></i> '+this.readyText;
this.savingText='<i class="fa fa-sync fa-spin"></i> '+this.readyText;this.savedText=this.readyText;this.errorText='<i class="fa fa-exclamation-triangle text-danger"></i> '+this.readyText;this.setStateLoading();this.getFilters(function(){tableFiltersLoaded?loadFilterButton.setStateReady():loadFilterButton.setStateNoFilters()})},getFilters:function(a,b){b=void 0===b?[]:b;$.ajax(Urls["dictionary:get_filters"](),{method:"POST",dataType:"json",async:!1,statusCode:{200:function(a){tableFilters=a;tableFiltersLoaded=
!0},404:function(){tableFilters=tableFiltersInit.valueOf();tableFiltersLoaded=!1},500:function(){tableFilters=tableFiltersInit.valueOf();tableFiltersLoaded=!1}},complete:function(){a.apply(null,$jscomp.arrayFromIterable(b))}})},saveFilters:function(){$.ajax(Urls["dictionary:save_filters"](),{method:"POST",data:JSON.stringify({filters:tableFilters}),contentType:"application/json",dataType:"json",beforeSend:function(){loadFilterButton.setStateSaving()},statusCode:{200:function(){loadFilterButton.afterSavingFilters()},
500:function(){loadFilterButton.afterSavingError()}}})},filter:function(){savingFiltersEnabled=!1;applyFilters("beforeLoad",tableFilters);updateTable(function(){applyFilters("afterLoad",tableFilters);applyFilters("selectAfterFilter",tableFilters);savingFiltersEnabled=!0},-1);loadFilterButton.setStateNoFilters()},loadAndFilter:function(){loadFilterButton.setStateLoading();loadFilterButton.getFilters(loadFilterButton.filter)},disable:function(){this.$button.attr("disabled","").addClass("disabled")},
setText:function(a){this.$button.empty().html(a)},setStateReady:function(){this.setText(this.readyText)},setStateSaving:function(){this.setText(this.savingText)},setStateSaved:function(){this.setText(this.savedText);this.disable()},setStateLoading:function(){this.setText(this.loadingText)},setStateNoFilters:function(){this.setText(this.readyText);this.disable()},afterSavingFilters:function(){this.setStateSaved()},afterSavingError:function(){this.setStateError(function(){loadFilterButton.saveFilters()})},
setStateError:function(a){this.setText(this.errorText);setTimeout(a,2E3)}};function toggle(a,b){b!==a.prop("checked")&&a.click()}function select(a,b){b!==a.val()&&(a.val(b),a.change())}
function saveFilters(a,b,c){savingFiltersEnabled&&($.each(b,function(b,e){tableFilters[a][e]={};tableFilters[a][e].attrs={};var d=$("#"+e);$.each(c,function(b,c){(b=d.attr(c))||(b=null);tableFilters[a][e].attrs[c]=b});d.val()?tableFilters[a][e].value=d.val():tableFilters[a][e].value=void 0;"undefined"!==typeof d.prop("checked")?tableFilters[a][e].checked=d.prop("checked"):tableFilters[a][e].checked=void 0}),loadFilterButton.saveFilters())}
function applyFilters(a,b){$.each(b[a],function(a,b){var c=$("#"+a);$.each(b.attrs,function(a,b){c.attr(a,b)});"undefined"!==typeof b.value&&select(c,b.value);"undefined"!==typeof b.checked&&toggle(c,b.checked)})}
function updateTable(a,b){b=void 0===b?50:b;var c=$("#filterWordsForm"),d=Urls["dictionary:my_words"]();$.ajax(d,{type:"POST",dataType:"json",data:c.serialize(),success:function(c){$table.html(c.table);void 0!==dt&&(dt.api().destroy(),$selectStars.remove());$table.DataTable({dom:"<'row'<'col-sm-12 mb-2'tr>><'row'<'#alert.col-12'><'#info.col-12'i><'col-sm-12 col-md-5'l><'col-sm-12 col-md-7'p>>",columnDefs:[{targets:0,render:function(a,b,c,e){"display"===b&&(a='<div class="checkbox"><input type="checkbox" id="checkbox-select-'+
a+'" class="dt-checkboxes"><label></label></div>');return a},checkboxes:{selectRow:!0,selectAllRender:'<div class="checkbox"><input type="checkbox" id="checkbox-select-all" class="dt-checkboxes"><label></label></div>'}}],select:"multi+shift",searching:!0,ordering:!1,paging:!0,pageLength:b,lengthMenu:[[50,100,250,500,-1],[50,100,250,500,"\u0412\u0441\u0435"]],language:{processing:"\u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435...",search:"\u041f\u043e\u0438\u0441\u043a:",lengthMenu:"\u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c: _MENU_",
info:"\u0421\u043b\u043e\u0432\u0430 \u0441 _START_ \u0434\u043e _END_ \u0438\u0437 _TOTAL_",infoEmpty:"\u0421\u043b\u043e\u0432\u0430 \u0441 0 \u0434\u043e 0 \u0438\u0437 0",infoFiltered:"(\u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u043d\u043e \u0438\u0437 _MAX_ \u0437\u0430\u043f\u0438\u0441\u0435\u0439)",infoPostFix:"",loadingRecords:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043b\u043e\u0432...",zeroRecords:"\u0421\u043b\u043e\u0432\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442.",
emptyTable:"\u0412 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0434\u0430\u043d\u043d\u044b\u0435",paginate:{first:"\u041f\u0435\u0440\u0432\u0430\u044f",previous:"\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0430\u044f",next:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f",last:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f"},aria:{sortAscending:": \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u0430 \u043f\u043e \u0432\u043e\u0437\u0440\u0430\u0441\u0442\u0430\u043d\u0438\u044e",
sortDescending:": \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u0430 \u043f\u043e \u0443\u0431\u044b\u0432\u0430\u043d\u0438\u044e"},select:{rows:{_:"\u0412\u044b\u0431\u0440\u0430\u043d\u043e \u0441\u043b\u043e\u0432: %d",0:"\u041a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043f\u043e \u0441\u043b\u043e\u0432\u0443 \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430",
1:"\u0412\u044b\u0431\u0440\u0430\u043d\u043e \u043e\u0434\u043d\u043e \u0441\u043b\u043e\u0432\u043e"}}},initComplete:function(){dt=this;var b=$(dt);saveFilters("beforeLoad",["id_packets"],[]);this.api().columns(-1).every(function(){$(this.header()).empty();$(starFilterHtml).appendTo($(this.header())).selectpicker({noneSelectedText:"\u041e\u0446\u0435\u043d\u043a\u0430",header:"\u041e\u0446\u0435\u043d\u043a\u0430",selectedTextFormat:"count > 1"}).on("change",function(){saveFilters("afterLoad",[this.id],
[]);var a=$(this).find(":selected").map(function(){return $(this).text()}).get().join("|");""===a?dt.api().column(-1).search(a,!1,!0).draw():(a="^"+a+"$",dt.api().column(-1).search(a,!0,!1).draw());add_selected_filtered_alert(dt)});$selectStars=$("#starFilter")});showDeleted($("#showDeleted")[0].checked);$("#showDeleted").on("change",function(a){a.preventDefault();saveFilters("afterLoad",[this.id],["checked"]);showDeleted(this.checked);add_selected_filtered_alert(dt)});b.on("select.dt.dtCheckboxes deselect.dt.dtCheckboxes",
function(a,b,c,e){if(savingFiltersEnabled){tableFilters.selectAfterFilter={};var d=[];$.each(get_selected_filtered(dt),function(a,b){d.push("checkbox-select-"+b)});saveFilters("selectAfterFilter",d,["checked"])}});void 0!==a&&a()}})},error:errorLoading,beforeSend:tableReloading});$(".undertable").show();$(".uppertable").show()}
function add_selected_filtered_alert(a){get_selected(a).sort().join(",")!==get_filtered(a).sort().join(",")?$("#alert").html('<div class="alert alert-info d-flex flex-row" role="alert"><i class="fas fa-fw fa-info-circle mr-3 mt-1"></i><div>\u041a \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u043c, \u043d\u043e \u0441\u043a\u0440\u044b\u0442\u044b\u043c \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u043c\u0438 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043d\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f.</div></div>').show():$("#alert").hide()}
function get_selected(a){a=a.api().column(0).checkboxes.selected();var b=[];$.each(a,function(a,d){b.push(d)});return b}function get_selected_filtered(a){var b=get_selected(a),c=get_filtered(a),d=[];b.forEach(function(a){c.includes(a)&&d.push(a)});return d}function get_filtered(a){return a.api().rows({search:"applied"}).data().pluck(0).toArray()}
$(document).ready(function(){$("#filterWordsForm").submit(function(a){a.preventDefault();updateTable()});$("#startApp").on("click",function(){var a=get_selected_filtered(dt);0===a.length?($("#startApp").popover({content:"\u0412\u044b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043b\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430",placement:"top",trigger:"manual"}).popover("show"),setTimeout(function(){$("#startApp").popover("hide").popover("dispose")},2E3)):
($("#startApp").popover("dispose"),$.ajax(Urls["dictionary:app"](),{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({words:a,csrfmiddlewaretoken:csrf}),error:errorLoading,success:function(a){window.location.href=Urls["dictionary:app"]()},beforeSend:emptyTable("")}))});$("#markWords").on("click",function(){$.ajax(Urls["dictionary:mark_words"](),{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({words:get_selected_filtered(dt),csrfmiddlewaretoken:csrf}),
success:function(a){updateTable()},error:errorLoading,beforeSend:tableReloading})});$("#unmarkWords").on("click",function(){dt.api().column(0).checkboxes.selected();$.ajax(Urls["dictionary:unmark_words"](),{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({words:get_selected_filtered(dt),csrfmiddlewaretoken:csrf}),success:function(a){updateTable()},error:errorLoading,beforeSend:tableReloading})});$("#main-frm").on("submit",function(a){var b=this,c=dt.api().column(0).checkboxes.selected();
$.each(c,function(a,c){$(b).append($("<input>").attr("type","hidden").attr("name","id[]").val(c))});a.preventDefault()});loadFilterButton.init()});
